<style>
  .question {
    margin-bottom: 1em;
  }
  .likert-scale {
    display: flex;
    justify-content: space-between;
    list-style-type: none;
    padding: 0;
  }
  .likert-item {
    text-align: center;
  }
</style>

<div id="question-container"></div>
<button id="next-button" disabled>Next</button>

<script>
  const questions = [
    { text: "我比較喜歡複雜而不喜歡簡單的問題。", reverse: false },
    { text: "我願意負責解決要花很多腦筋的事。", reverse: false },
    { text: "我不以思考為樂。", reverse: true },
    { text: "我比較喜歡去做不用思考的事,而不願去做需要思考的事。", reverse: true },
    { text: "我對那些要花很多心思去想事情的情境,避之唯恐不及。", reverse: true },
    { text: "我從深思和長考中得到滿足。", reverse: false },
    { text: "我不費心去多想。", reverse: true },
    { text: "與其去想一些長期計劃,我寧願想一些小的日常計劃。 ", reverse: true },
    { text: "我喜歡那些一旦學會就不用再想的工作。", reverse: true },
    { text: "靠著思考去往上爬的想法正合我意。", reverse: false },
    { text: "我喜歡那些需要想出新的方法來解決問題的工作。", reverse: false },
    { text: "學習新的思考方式沒有甚麼意思。", reverse: true },
    { text: "我願我這一生充滿著我必須解決的難題。", reverse: false },
    { text: "我喜歡抽象地思考。", reverse: false },
    { text: "我喜歡需要動腦筋且困難的重要工作,而不喜歡還算重要但不需多想的工作。", reverse: false },
    { text: "當我完成一件很費心力的工作後,我感到的是解脫而不是滿足。", reverse: true },
    { text: "我只在乎工作是否完成,我不在意 它是如何或爲何做成的。", reverse: true },
    { text: "即使一些事務跟我個人沒有切身關係,我常會去對它們深思熟慮一番。", reverse: false }
  ];

  let currentQuestionIndex = 0;
  let responses = [];
  let randomizedQuestions = [];

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function showQuestion() {
    const questionContainer = document.getElementById('question-container');
    const question = randomizedQuestions[currentQuestionIndex];
    questionContainer.innerHTML = `
      <div class="question">
        <p>${currentQuestionIndex + 1}. ${question.text}</p>
        <ul class="likert-scale">
          <li class="likert-item"><input type="radio" name="q" value="0" required> 非常不符合</li>
          <li class="likert-item"><input type="radio" name="q" value="1"></li>
          <li class="likert-item"><input type="radio" name="q" value="2"></li>
          <li class="likert-item"><input type="radio" name="q" value="3"></li>
          <li class="likert-item"><input type="radio" name="q" value="4"></li>
          <li class="likert-item"><input type="radio" name="q" value="5"> 非常符合</li>
        </ul>
      </div>
    `;
    const nextButton = document.getElementById('next-button');
    nextButton.disabled = true;
    const radioButtons = document.querySelectorAll('input[name="q"]');
    radioButtons.forEach(button => {
      button.addEventListener('change', () => {
        nextButton.disabled = false;
      });
    });
  }

  function nextQuestion() {
    const selectedValue = document.querySelector('input[name="q"]:checked');
    if (selectedValue) {
      let score = parseInt(selectedValue.value);
      if (randomizedQuestions[currentQuestionIndex].reverse) {
        score = 5 - score;
      }
      responses.push({
        question: randomizedQuestions[currentQuestionIndex].text,
        score: score
      });
      currentQuestionIndex++;
      if (currentQuestionIndex < randomizedQuestions.length) {
        showQuestion();
      } else {
        showTotalScore();
      }
    }
  }

  function showTotalScore() {
    const container = document.getElementById('question-container');
    const totalScore = responses.reduce((acc, curr) => acc + curr.score, 0);
    container.innerHTML = `
      <h2>問卷完成</h2>
      <p>您的總分是：${totalScore}</p>
    `;
    document.getElementById('next-button').style.display = 'none';
    jatos.appendResultData({ nfc_score: totalScore, responses: responses });
    setTimeout(() => {
      jatos.startNextComponent();
    }, 2000);
  }

  randomizedQuestions = [...questions];
  shuffle(randomizedQuestions);
  showQuestion();
  const nextButton = document.getElementById('next-button');
  nextButton.addEventListener('click', nextQuestion);
</script>